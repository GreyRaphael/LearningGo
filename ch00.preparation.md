# Preparation

- [Preparation](#preparation)
	- [Fedora](#fedora)
	- [Windows](#windows)
	- [`main`](#main)

## Fedora

Prepare development environment
1. Install golang SDK, `sudo dnf install golang`
1. VSCode install go extension
1. VSCode, `F1`, `Go: Install/Update Tools`(需要clash, global tunneled proxy)

example: create a simple project
> [How to use Go modules](https://www.digitalocean.com/community/tutorials/how-to-use-go-modules)

```bash
mkdir proj1
cd proj1

go mod init proj1
go mod tidy

touch main.go

go run .
# go run main.go

# build a binary 
go build

# reduce binary size
go build -ldflags="-s -w"
```

```bash
└── proj1
    └── main.go
    └── go.mod
```

```go
// main.go
package main

import "fmt"

func main() {
	fmt.Println("Hello, Modules!")
}
```

example: add custom module

```bash
└── proj1
    └── main.go
    └── go.mod
    └── mypackage
        └── mymath.go
        └── myphysics.go
```

```go
// mymath.go
package mypackage

import "fmt"

func PrintMath() {
	fmt.Println("Hello, Modules! from PrintMath!")
}
```

```go
// myphysics.go
package mypackage

import "fmt"

func PrintPhysics() {
	fmt.Println("Hello, Modules! from PrintPhysics")
}
```

```go
// main.go
package main

import (
	"fmt"
	"proj1/mypackage"
)

func main() {
	fmt.Println("hello world")
	mypackage.PrintMath()
	mypackage.PrintPhysics()
}
```

```bash
go run .
# or
go run main.go
```

example: add remote dependency from github.com, and etc.

```bash
└── proj1
    └── main.go
    └── go.mod
    └── mypackage
        └── mymath.go
        └── myphysics.go
```

```bash
# cobra被下载到 gopath/pkg
go get github.com/spf13/cobra
```

```go
// main.go
package main

import (
	"fmt"
	"proj1/mypackage"

	"github.com/spf13/cobra"
)

func main() {
	cmd := &cobra.Command{
		Run: func(cmd *cobra.Command, args []string) {
			fmt.Println("Hello World!")
			mypackage.PrintMath()
			mypackage.PrintPhysics()
		},
	}
	cmd.Execute()
}
```

## Windows

Prepare development environment
1. download golang sdk zip, <https://go.dev/dl/>
2. modify `go.env` file
3. manually install gotools
4. install vscode extension and setup


```bash
# D:/Dev/Golang/goroot/go.env
GOPROXY=https://proxy.golang.org,direct
GOSUMDB=sum.golang.org
# add this line
GOPATH=D:\Dev\Golang\gopath

GOTOOLCHAIN=auto
```

change proxy and install gotools
- `go env -w GO111MODULE=on`
- `go env -w GOPROXY=https://goproxy.cn,direct`
- vscode notify gotools installation "Install All"

```bash
# install gotools in terminal
go install -v golang.org/x/tools/gopls@latest
go install -v golang.org/x/tools/cmd/goimports@latest
go install -v github.com/cweill/gotests/gotests@latest
go install -v github.com/fatih/gomodifytags@latest
go install -v github.com/josharian/impl@latest
go install -v github.com/haya14busa/goplay/cmd/goplay@latest
go install -v github.com/go-delve/delve/cmd/dlv@latest
go install -v honnef.co/go/tools/cmd/staticcheck@latest
```

```json
// vscode, settings.json
{
	"go.goroot": "D:\\Dev\\Golang\\goroot",
    "go.inlayHints.assignVariableTypes": true,
    "go.inlayHints.compositeLiteralFields": true,
    "go.inlayHints.compositeLiteralTypes": true,
    "go.inlayHints.constantValues": true,
    "go.inlayHints.functionTypeParameters": true,
    "go.inlayHints.parameterNames": true,
    "go.inlayHints.rangeVariableTypes": true
}
```

## `main`

- `package main`用来生成可执行文件，每个程序只有一个main包, 多个文件可以属于同一个`package main`

```bash
./
	go.mod
	main.go
	submain.go
```

run program: `go run .` or `go run main.go submain.go`

```go
// main.go
package main

import "fmt"

func mysub(x int, y int) int {
	return x - y
}

func main() {
	fmt.Println("myadd, ", myadd(10, 20))
	fmt.Println("mysub, ", mysub(10, 20))
}
```

```go
// submain.go
package main

func myadd(x int, y int) int {
	return x + y
}
```

- Go中的`func main`不支持任何返回值，通过`os.Exit()`来返回状态
- Go中的`func main`不支持传入参数，通过`os.Args`获取命令行参数

```go
package main

import (
	"fmt"
	"os"
)

func main() {
	fmt.Println("args=", os.Args)
	os.Exit(-1)
}
```