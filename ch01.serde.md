# Serde

- [Serde](#serde)
	- [json](#json)
	- [ini](#ini)

## json

serde simple json

```go
package main

import (
	"encoding/json"
	"fmt"
)

func main() {
	// string to map
	j_str1 := `{"a":100, "b":200.1}`
	j_data1 := map[string]float64{}
	json.Unmarshal([]byte(j_str1), &j_data1)
	fmt.Println(j_data1)
	fmt.Println(j_data1["b"])

	// map to string
	j_data2 := map[string]int32{"a": 100, "b": 300}
	j_bytes2, _ := json.Marshal(j_data2)
	fmt.Println(j_bytes2)
	fmt.Println(string(j_bytes2))
}
```

serde nested json

```go
package main

import (
	"encoding/json"
	"fmt"
)

func main() {
	j_str1 := `{
        "fruits" : {
            "a": 10.2,
            "b": 100
        },
        "colors" : {
            "r": 20,
            "g": 100.2
        }
    }`

	var j_data1 map[string]map[string]float64

	json.Unmarshal([]byte(j_str1), &j_data1)
	fmt.Println(j_data1)
	fmt.Println(j_data1["colors"]["g"])
}
```

serde different types

```go
package main

import (
	"encoding/json"
	"fmt"
)

func main() {
	j_str1 := `{
        "fruits" : {
            "a": "apple",
            "b": 100
        },
        "colors" : {
            "r": "red",
            "g": 100.2
        }
    }`

	var j_data1 map[string]interface{}

	json.Unmarshal([]byte(j_str1), &j_data1)
	fmt.Println(j_data1)
	fmt.Println(j_data1["colors"])
	val, _ := j_data1["colors"].(map[string]interface{})
	fmt.Println(val["g"])
}
```

json file to `struct`

```json
{
  "users": [
    {
      "name": "Elliot",
      "type": "Reader",
      "age": 23,
      "social": {
        "facebook": "https://facebook.com",
        "twitter": "https://twitter.com"
      }
    },
    {
      "name": "Fraser",
      "type": "Author",
      "age": 17,
      "social": {
        "facebook": "https://facebook.com",
        "twitter": "https://twitter.com"
      }
    }
  ]
}
```

```go
package main

import (
	"encoding/json"
	"fmt"
	"io"
	"os"
	"strconv"
)

// Users struct which contains an array of users
type Users struct {
	Users []User `json:"users"`
}

// User struct which contains a name a type and a list of social links
type User struct {
	Name   string `json:"name"`
	Type   string `json:"type"`
	Age    int    `json:"Age"`
	Social Social `json:"social"`
}

// Social struct which contains a list of links
type Social struct {
	Facebook string `json:"facebook"`
	Twitter  string `json:"twitter"`
}

func main() {
	jsonFile, _ := os.Open("users.json")
	// defer the closing of our jsonFile so that we can parse it later on
	defer jsonFile.Close()

	byteValue, _ := io.ReadAll((jsonFile))

	var users Users
	json.Unmarshal(byteValue, &users)

	for i := 0; i < len(users.Users); i++ {
		fmt.Println("User Type: " + users.Users[i].Type)
		fmt.Println("User Age: " + strconv.Itoa(users.Users[i].Age))
		fmt.Println("User Name: " + users.Users[i].Name)
		fmt.Println("Facebook Url: " + users.Users[i].Social.Facebook)
		fmt.Println()
	}
}
```

struct tag dash `-`

```go
package main

import (
	"encoding/json"
	"fmt"
)

type Person struct {
	Name   string `json:"name"`
	Age    int    `json:"age"`
	SkipMe string `json:"-"`
}

func main() {
	// Marshaling
	person := Person{Name: "John Doe", Age: 30, SkipMe: "This should be skipped"}
	jsonData, err := json.Marshal(person)
	if err != nil {
		fmt.Println("Error marshaling:", err)
		return
	}
	fmt.Println("Marshaled JSON:", string(jsonData)) // Marshaled JSON: {"name":"John Doe","age":30}

	// Unmarshaling
	var newPerson Person
	err = json.Unmarshal(jsonData, &newPerson)
	if err != nil {
		fmt.Println("Error unmarshaling:", err)
		return
	}
	fmt.Printf("Unmarshaled Person: %+v\n", newPerson) // Unmarshaled Person: {Name:John Doe Age:30 SkipMe:}
}
```

struct tag `omitempty`

```go
package main

import (
	"encoding/json"
	"fmt"
)

type Person struct {
	Name  string `json:"name,omitempty"`
	Age   int    `json:"age,omitempty"`
	Skill string `json:"skill,omitempty"`
}

func main() {
	// Marshaling with some zero values
	person := Person{Name: "", Age: 0, Skill: ""}
	jsonData, err := json.Marshal(person)
	if err != nil {
		fmt.Println("Error marshaling:", err)
		return
	}
	fmt.Println("Marshaled JSON with omitempty:", string(jsonData)) // Marshaled JSON with omitempty: {}

	// Unmarshaling
	var newPerson Person
	err = json.Unmarshal(jsonData, &newPerson)
	if err != nil {
		fmt.Println("Error unmarshaling:", err)
		return
	}
	fmt.Printf("Unmarshaled Person: %+v\n", newPerson) // Unmarshaled Person: {Name: Age:0 Skill:}
}
```

## ini

read/write ini file

```go
package main

import (
	"fmt"

	"gopkg.in/ini.v1"
)

func main() {
	// read ini
	config, _ := ini.Load("config.ini")
	section1 := config.Section("database")
	host := section1.Key("host").String()
	port := section1.Key("port").MustInt()
	username := section1.Key("username").String()
	password := section1.Key("password").String()
	fmt.Println(host, port, username, password)

	section2 := config.Section("database.options")
	for _, key := range section2.Keys() {
		fmt.Println(key.Name(), key.Value())
	}

	// write ini
	ini_data := ini.Empty()
	sec1, _ := ini_data.NewSection("database")
	sec1.NewKey("host", "127.0.0.1")
	sec1.NewKey("port", "6666")
	ini_data.SaveTo("config2.ini")
}
```