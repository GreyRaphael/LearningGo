# Serde

- [Serde](#serde)
  - [json](#json)

## json

serde simple json

```go
package main

import (
	"encoding/json"
	"fmt"
)

func main() {
	// string to map
	j_str1 := `{"a":100, "b":200.1}`
	j_data1 := map[string]float64{}
	json.Unmarshal([]byte(j_str1), &j_data1)
	fmt.Println(j_data1)
	fmt.Println(j_data1["b"])

	// map to string
	j_data2 := map[string]int32{"a": 100, "b": 300}
	j_bytes2, _ := json.Marshal(j_data2)
	fmt.Println(j_bytes2)
	fmt.Println(string(j_bytes2))
}
```

serde nested json

```go
package main

import (
	"encoding/json"
	"fmt"
)

func main() {
	j_str1 := `{
        "fruits" : {
            "a": 10.2,
            "b": 100
        },
        "colors" : {
            "r": 20,
            "g": 100.2
        }
    }`

	var j_data1 map[string]map[string]float64

	json.Unmarshal([]byte(j_str1), &j_data1)
	fmt.Println(j_data1)
	fmt.Println(j_data1["colors"]["g"])
}
```

serde different types

```go
package main

import (
	"encoding/json"
	"fmt"
)

func main() {
	j_str1 := `{
        "fruits" : {
            "a": "apple",
            "b": 100
        },
        "colors" : {
            "r": "red",
            "g": 100.2
        }
    }`

	var j_data1 map[string]interface{}

	json.Unmarshal([]byte(j_str1), &j_data1)
	fmt.Println(j_data1)
	fmt.Println(j_data1["colors"])
	val, _ := j_data1["colors"].(map[string]interface{})
	fmt.Println(val["g"])
}
```

json file to `struct`

```json
{
  "users": [
    {
      "name": "Elliot",
      "type": "Reader",
      "age": 23,
      "social": {
        "facebook": "https://facebook.com",
        "twitter": "https://twitter.com"
      }
    },
    {
      "name": "Fraser",
      "type": "Author",
      "age": 17,
      "social": {
        "facebook": "https://facebook.com",
        "twitter": "https://twitter.com"
      }
    }
  ]
}
```

```go
package main

import (
	"encoding/json"
	"fmt"
	"io"
	"os"
	"strconv"
)

// Users struct which contains an array of users
type Users struct {
	Users []User `json:"users"`
}

// User struct which contains a name a type and a list of social links
type User struct {
	Name   string `json:"name"`
	Type   string `json:"type"`
	Age    int    `json:"Age"`
	Social Social `json:"social"`
}

// Social struct which contains a list of links
type Social struct {
	Facebook string `json:"facebook"`
	Twitter  string `json:"twitter"`
}

func main() {
	jsonFile, _ := os.Open("users.json")
	// defer the closing of our jsonFile so that we can parse it later on
	defer jsonFile.Close()

	byteValue, _ := io.ReadAll((jsonFile))

	var users Users
	json.Unmarshal(byteValue, &users)

	for i := 0; i < len(users.Users); i++ {
		fmt.Println("User Type: " + users.Users[i].Type)
		fmt.Println("User Age: " + strconv.Itoa(users.Users[i].Age))
		fmt.Println("User Name: " + users.Users[i].Name)
		fmt.Println("Facebook Url: " + users.Users[i].Social.Facebook)
		fmt.Println()
	}
}
```